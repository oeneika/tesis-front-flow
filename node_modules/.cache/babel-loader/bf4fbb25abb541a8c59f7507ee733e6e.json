{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\alexa\\\\Documents\\\\Tesis-front\\\\StarterKit\\\\src\\\\pages\\\\Camera\\\\index.js\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport * as faceapi from \"face-api.js\";\nimport { Container, Row, Col, Card, CardBody, ButtonGroup, Button, Modal, ModalHeader, ModalBody, ModalFooter } from \"reactstrap\"; //Import Breadcrumb\n\nimport Breadcrumbs from \"../../components/Common/Breadcrumb\";\nimport Webcam from \"react-webcam\";\n\nconst Camera = () => {\n  const videoHeight = 1280;\n  const videoWidth = 720;\n  const webcamRef = React.useRef(null);\n  const canvasRef = useRef();\n  const mediaRecorderRef = React.useRef(null);\n  const [capturing, setCapturing] = React.useState(false);\n  const [recordedChunks, setRecordedChunks] = React.useState([]);\n  useEffect(() => {\n    const loadModels = async () => {\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\n      Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL), faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL)]).then(startVideo);\n    };\n\n    loadModels();\n  }, []);\n\n  const startVideo = () => {\n    navigator.getUserMedia({\n      video: {}\n    }, stream => webcamRef.current.srcObject = stream, err => console.log(err));\n  };\n\n  const handleVideoOnPlay = () => {\n    console.log(\"hola\");\n    setInterval(async () => {\n      canvasRef.current.innetHTML = faceapi.createCanvasFromMedia(webcamRef.current);\n      const displaySize = {\n        width: videoWidth,\n        height: videoHeight\n      };\n      const detections = await faceapi.detectAllFaces(webcamRef.current, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();\n      console.log(detections);\n      const resizedDetections = faceapi.resizeResults(detections, displaySize);\n      canvasRef.current.getContext(\"2d\").clearRect(0, 0, videoWidth, videoHeight);\n      faceapi.draw.drawDetections(canvasRef.current, resizedDetections);\n      faceapi.draw.DrawFaceLandmarks(canvasRef.current, resizedDetections);\n      faceapi.draw.drawFaceExpressions(canvasRef.current, resizedDetections);\n      console.log(detections);\n    }, 1000);\n  };\n\n  const handleStartCaptureClick = React.useCallback(() => {\n    handleVideoOnPlay();\n    setCapturing(true);\n    mediaRecorderRef.current = new MediaRecorder(webcamRef.current.stream, {\n      mimeType: \"video/webm\"\n    });\n    mediaRecorderRef.current.addEventListener(\"dataavailable\", handleDataAvailable);\n    mediaRecorderRef.current.start();\n  }, [webcamRef, setCapturing, mediaRecorderRef]);\n  const handleDataAvailable = React.useCallback(({\n    data\n  }) => {\n    if (data.size > 0) {\n      setRecordedChunks(prev => prev.concat(data));\n    }\n  }, [setRecordedChunks]);\n  const handleStopCaptureClick = React.useCallback(() => {\n    mediaRecorderRef.current.stop();\n    setCapturing(false);\n  }, [mediaRecorderRef, webcamRef, setCapturing]);\n  const handleDownload = React.useCallback(() => {\n    if (recordedChunks.length) {\n      const blob = new Blob(recordedChunks, {\n        type: \"video/mp4\"\n      });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      document.body.appendChild(a);\n      a.style = \"display: none\";\n      a.href = url;\n      a.download = \"react-webcam-stream-capture.mp4\";\n      a.click();\n      window.URL.revokeObjectURL(url);\n      setRecordedChunks([]);\n    }\n  }, [recordedChunks]);\n  const handleDownloadImage = React.useCallback(() => {\n    toggle();\n    const blob = new Blob(recordedChunks, {\n      type: \"image/jpg\"\n    });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    document.body.appendChild(a);\n    a.style = \"display: none\";\n    a.href = url;\n    a.download = \"react-webcam-stream-capture.jpg\";\n    a.click();\n    window.URL.revokeObjectURL(url);\n    setRecordedChunks([]);\n  });\n  const videoConstraints = {\n    width: 1280,\n    height: 720,\n    facingMode: \"user\"\n  };\n  const [imgSrc, setImgSrc] = React.useState(null);\n  const capture = React.useCallback(() => {\n    toggle();\n    const imageSrc = webcamRef.current.getScreenshot();\n    setImgSrc(imageSrc);\n  }, [webcamRef, setImgSrc]);\n  const [modal, setModal] = useState(false);\n\n  const toggle = () => setModal(!modal);\n\n  return /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(Modal, {\n    isOpen: modal,\n    toggle: toggle,\n    centered: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(ModalHeader, {\n    toggle: toggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 5\n    }\n  }, \"Imagen capturada\"), /*#__PURE__*/React.createElement(ModalBody, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 5\n    }\n  }, imgSrc && /*#__PURE__*/React.createElement(\"img\", {\n    src: imgSrc,\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(ModalFooter, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    color: \"primary\",\n    onClick: handleDownloadImage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 6\n    }\n  }, \"Descargar\"), \" \", /*#__PURE__*/React.createElement(Button, {\n    color: \"secondary\",\n    onClick: toggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 6\n    }\n  }, \"Guardar\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"page-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(Container, {\n    fluid: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Breadcrumbs, {\n    title: \"C\\xE1maras\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 6\n    }\n  }), /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    xl: \"12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Card, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 8\n    }\n  }, /*#__PURE__*/React.createElement(CardBody, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"float-right d-none d-md-inline-block\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 10\n    }\n  }, /*#__PURE__*/React.createElement(ButtonGroup, {\n    className: \"mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 11\n    }\n  }, capturing ? /*#__PURE__*/React.createElement(Button, {\n    size: \"md\",\n    color: \"light\",\n    type: \"button\",\n    onClick: handleStopCaptureClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }\n  }, \"Detener video\") : /*#__PURE__*/React.createElement(Button, {\n    size: \"md\",\n    color: \"light\",\n    type: \"button\",\n    onClick: handleStartCaptureClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 13\n    }\n  }, \"Iniciar video\"), recordedChunks.length > 0 && /*#__PURE__*/React.createElement(Button, {\n    onClick: handleDownload,\n    size: \"md\",\n    color: \"success\",\n    type: \"button\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 13\n    }\n  }, \"Descargar\"), /*#__PURE__*/React.createElement(Button, {\n    size: \"md\",\n    color: \"light\",\n    type: \"button\",\n    onClick: capture,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 12\n    }\n  }, \"Capturar foto\"))), /*#__PURE__*/React.createElement(\"h4\", {\n    className: \"card-title mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 10\n    }\n  }, \"Sala de mi casa\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"embed-responsive embed-responsive-21by9\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 10\n    }\n  }, /*#__PURE__*/React.createElement(Webcam, {\n    ref: webcamRef,\n    width: 1280,\n    videoConstraints: videoConstraints,\n    screenshotFormat: \"image/jpeg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"canvas\", {\n    className: \"position-absolute\",\n    ref: canvasRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 11\n    }\n  })))))))));\n};\n\nexport default Camera;","map":{"version":3,"sources":["C:/Users/alexa/Documents/Tesis-front/StarterKit/src/pages/Camera/index.js"],"names":["React","useState","useEffect","useRef","faceapi","Container","Row","Col","Card","CardBody","ButtonGroup","Button","Modal","ModalHeader","ModalBody","ModalFooter","Breadcrumbs","Webcam","Camera","videoHeight","videoWidth","webcamRef","canvasRef","mediaRecorderRef","capturing","setCapturing","recordedChunks","setRecordedChunks","loadModels","MODEL_URL","process","env","PUBLIC_URL","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","faceExpressionNet","then","startVideo","navigator","getUserMedia","video","stream","current","srcObject","err","console","log","handleVideoOnPlay","setInterval","innetHTML","createCanvasFromMedia","displaySize","width","height","detections","detectAllFaces","TinyFaceDetectorOptions","withFaceLandmarks","withFaceExpressions","resizedDetections","resizeResults","getContext","clearRect","draw","drawDetections","DrawFaceLandmarks","drawFaceExpressions","handleStartCaptureClick","useCallback","MediaRecorder","mimeType","addEventListener","handleDataAvailable","start","data","size","prev","concat","handleStopCaptureClick","stop","handleDownload","length","blob","Blob","type","url","URL","createObjectURL","a","document","createElement","body","appendChild","style","href","download","click","window","revokeObjectURL","handleDownloadImage","toggle","videoConstraints","facingMode","imgSrc","setImgSrc","capture","imageSrc","getScreenshot","modal","setModal"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useRef} from \"react\";\r\nimport * as faceapi from \"face-api.js\";\r\nimport {\r\n\tContainer,\r\n\tRow,\r\n\tCol,\r\n\tCard,\r\n\tCardBody,\r\n\tButtonGroup,\r\n\tButton,\r\n\tModal,\r\n\tModalHeader,\r\n\tModalBody,\r\n\tModalFooter,\r\n} from \"reactstrap\";\r\n//Import Breadcrumb\r\nimport Breadcrumbs from \"../../components/Common/Breadcrumb\";\r\nimport Webcam from \"react-webcam\";\r\n\r\nconst Camera = () => {\r\n\tconst videoHeight = 1280;\r\n\tconst videoWidth = 720;\r\n\tconst webcamRef = React.useRef(null);\r\n\tconst canvasRef = useRef();\r\n\tconst mediaRecorderRef = React.useRef(null);\r\n\tconst [capturing, setCapturing] = React.useState(false);\r\n\tconst [recordedChunks, setRecordedChunks] = React.useState([]);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst loadModels = async () => {\r\n\t\t\tconst MODEL_URL = process.env.PUBLIC_URL + \"/models\";\r\n\t\t\tPromise.all([\r\n\t\t\t\tfaceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n\t\t\t\tfaceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n\t\t\t\tfaceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\r\n\t\t\t\tfaceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL),\r\n\t\t\t]).then(startVideo);\r\n\t\t};\r\n\t\tloadModels();\r\n\t}, []);\r\n\r\n\tconst startVideo = () => {\r\n\t\tnavigator.getUserMedia(\r\n\t\t\t{\r\n\t\t\t\tvideo: {},\r\n\t\t\t},\r\n\t\t\t(stream) => (webcamRef.current.srcObject = stream),\r\n\t\t\t(err) => console.log(err)\r\n\t\t);\r\n\t};\r\n\r\n\tconst handleVideoOnPlay = () => {\r\n\t\tconsole.log(\"hola\");\r\n\t\tsetInterval(async () => {\r\n\t\t\tcanvasRef.current.innetHTML = faceapi.createCanvasFromMedia(\r\n\t\t\t\twebcamRef.current\r\n\t\t\t);\r\n\t\t\tconst displaySize = {\r\n\t\t\t\twidth: videoWidth,\r\n\t\t\t\theight: videoHeight,\r\n\t\t\t};\r\n\r\n\t\t\tconst detections = await faceapi\r\n\t\t\t\t.detectAllFaces(\r\n\t\t\t\t\twebcamRef.current,\r\n\t\t\t\t\tnew faceapi.TinyFaceDetectorOptions()\r\n\t\t\t\t)\r\n\t\t\t\t.withFaceLandmarks()\r\n\t\t\t\t.withFaceExpressions();\r\n\t\t\tconsole.log(detections);\r\n\t\t\tconst resizedDetections = faceapi.resizeResults(detections, displaySize);\r\n\t\t\tcanvasRef.current\r\n\t\t\t\t.getContext(\"2d\")\r\n\t\t\t\t.clearRect(0, 0, videoWidth, videoHeight);\r\n\t\t\tfaceapi.draw.drawDetections(canvasRef.current, resizedDetections);\r\n\t\t\tfaceapi.draw.DrawFaceLandmarks(canvasRef.current, resizedDetections);\r\n\t\t\tfaceapi.draw.drawFaceExpressions(canvasRef.current, resizedDetections);\r\n\t\t\tconsole.log(detections);\r\n\t\t}, 1000);\r\n\t};\r\n\r\n\tconst handleStartCaptureClick = React.useCallback(() => {\r\n\t\thandleVideoOnPlay();\r\n\t\tsetCapturing(true);\r\n\t\tmediaRecorderRef.current = new MediaRecorder(webcamRef.current.stream, {\r\n\t\t\tmimeType: \"video/webm\",\r\n\t\t});\r\n\t\tmediaRecorderRef.current.addEventListener(\r\n\t\t\t\"dataavailable\",\r\n\t\t\thandleDataAvailable\r\n\t\t);\r\n\t\tmediaRecorderRef.current.start();\r\n\t}, [webcamRef, setCapturing, mediaRecorderRef]);\r\n\r\n\tconst handleDataAvailable = React.useCallback(\r\n\t\t({data}) => {\r\n\t\t\tif (data.size > 0) {\r\n\t\t\t\tsetRecordedChunks((prev) => prev.concat(data));\r\n\t\t\t}\r\n\t\t},\r\n\t\t[setRecordedChunks]\r\n\t);\r\n\r\n\tconst handleStopCaptureClick = React.useCallback(() => {\r\n\t\tmediaRecorderRef.current.stop();\r\n\t\tsetCapturing(false);\r\n\t}, [mediaRecorderRef, webcamRef, setCapturing]);\r\n\r\n\tconst handleDownload = React.useCallback(() => {\r\n\t\tif (recordedChunks.length) {\r\n\t\t\tconst blob = new Blob(recordedChunks, {\r\n\t\t\t\ttype: \"video/mp4\",\r\n\t\t\t});\r\n\t\t\tconst url = URL.createObjectURL(blob);\r\n\t\t\tconst a = document.createElement(\"a\");\r\n\t\t\tdocument.body.appendChild(a);\r\n\t\t\ta.style = \"display: none\";\r\n\t\t\ta.href = url;\r\n\t\t\ta.download = \"react-webcam-stream-capture.mp4\";\r\n\t\t\ta.click();\r\n\t\t\twindow.URL.revokeObjectURL(url);\r\n\t\t\tsetRecordedChunks([]);\r\n\t\t}\r\n\t}, [recordedChunks]);\r\n\r\n\tconst handleDownloadImage = React.useCallback(() => {\r\n\t\ttoggle();\r\n\t\tconst blob = new Blob(recordedChunks, {\r\n\t\t\ttype: \"image/jpg\",\r\n\t\t});\r\n\t\tconst url = URL.createObjectURL(blob);\r\n\t\tconst a = document.createElement(\"a\");\r\n\t\tdocument.body.appendChild(a);\r\n\t\ta.style = \"display: none\";\r\n\t\ta.href = url;\r\n\t\ta.download = \"react-webcam-stream-capture.jpg\";\r\n\t\ta.click();\r\n\t\twindow.URL.revokeObjectURL(url);\r\n\t\tsetRecordedChunks([]);\r\n\t});\r\n\r\n\tconst videoConstraints = {\r\n\t\twidth: 1280,\r\n\t\theight: 720,\r\n\t\tfacingMode: \"user\",\r\n\t};\r\n\r\n\tconst [imgSrc, setImgSrc] = React.useState(null);\r\n\r\n\tconst capture = React.useCallback(() => {\r\n\t\ttoggle();\r\n\t\tconst imageSrc = webcamRef.current.getScreenshot();\r\n\t\tsetImgSrc(imageSrc);\r\n\t}, [webcamRef, setImgSrc]);\r\n\r\n\tconst [modal, setModal] = useState(false);\r\n\r\n\tconst toggle = () => setModal(!modal);\r\n\r\n\treturn (\r\n\t\t<React.Fragment>\r\n\t\t\t<Modal isOpen={modal} toggle={toggle} centered={true}>\r\n\t\t\t\t<ModalHeader toggle={toggle}>Imagen capturada</ModalHeader>\r\n\t\t\t\t<ModalBody>\r\n\t\t\t\t\t{imgSrc && <img src={imgSrc} className=\"w-100\" />}\r\n\t\t\t\t</ModalBody>\r\n\t\t\t\t<ModalFooter>\r\n\t\t\t\t\t<Button color=\"primary\" onClick={handleDownloadImage}>\r\n\t\t\t\t\t\tDescargar\r\n\t\t\t\t\t</Button>{\" \"}\r\n\t\t\t\t\t<Button color=\"secondary\" onClick={toggle}>\r\n\t\t\t\t\t\tGuardar\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</ModalFooter>\r\n\t\t\t</Modal>\r\n\t\t\t<div className=\"page-content\">\r\n\t\t\t\t<Container fluid>\r\n\t\t\t\t\t<Breadcrumbs title=\"Cámaras\" />\r\n\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t<Col xl=\"12\">\r\n\t\t\t\t\t\t\t<Card>\r\n\t\t\t\t\t\t\t\t<CardBody>\r\n\t\t\t\t\t\t\t\t\t<div className=\"float-right d-none d-md-inline-block\">\r\n\t\t\t\t\t\t\t\t\t\t<ButtonGroup className=\"mb-4\">\r\n\t\t\t\t\t\t\t\t\t\t\t{capturing ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"md\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={handleStopCaptureClick}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tDetener video\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"md\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={handleStartCaptureClick}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tIniciar video\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t{recordedChunks.length > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={handleDownload}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"md\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"success\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tDescargar\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"md\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={capture}>\r\n\t\t\t\t\t\t\t\t\t\t\t\tCapturar foto\r\n\t\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t\t</ButtonGroup>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<h4 className=\"card-title mb-4\">Sala de mi casa</h4>\r\n\t\t\t\t\t\t\t\t\t<div className=\"embed-responsive embed-responsive-21by9\">\r\n\t\t\t\t\t\t\t\t\t\t<Webcam\r\n\t\t\t\t\t\t\t\t\t\t\tref={webcamRef}\r\n\t\t\t\t\t\t\t\t\t\t\twidth={1280}\r\n\t\t\t\t\t\t\t\t\t\t\tvideoConstraints={videoConstraints}\r\n\t\t\t\t\t\t\t\t\t\t\tscreenshotFormat=\"image/jpeg\"\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t<canvas className=\"position-absolute\" ref={canvasRef} />\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</CardBody>\r\n\t\t\t\t\t\t\t</Card>\r\n\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t</Row>\r\n\t\t\t\t</Container>\r\n\t\t\t</div>\r\n\t\t</React.Fragment>\r\n\t);\r\n};\r\n\r\nexport default Camera;\r\n"]},"metadata":{},"sourceType":"module"}